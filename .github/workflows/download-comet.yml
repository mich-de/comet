name: Download Comet Latest

on:
  schedule:
    # Ogni giorno alle 00:00 UTC
    - cron: '0 0 * * *'
  workflow_dispatch:  # Puoi anche avviare manualmente

jobs:
  download:
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v3
      
      - name: Download Comet Windows 64-bit
        run: |
          mkdir -p releases
          curl -L -o releases/comet-installer-win_x64.exe \
            "https://www.perplexity.ai/rest/browser/download?platform=win_x64&channel=stable"
          
      - name: Download Comet Windows 32-bit
        run: |
          curl -L -o releases/comet-installer-win_ia32.exe \
            "https://www.perplexity.ai/rest/browser/download?platform=win_ia32&channel=stable"
      
      - name: Download Comet macOS
        run: |
          curl -L -o releases/comet-installer-darwin.dmg \
            "https://www.perplexity.ai/rest/browser/download?platform=darwin&channel=stable"
      
      - name: Get file info
        run: |
          ls -lh releases/
          echo "DOWNLOAD_DATE=$(date -u +'%Y-%m-%d %H:%M:%S UTC')" >> $GITHUB_ENV
      
      - name: Commit e Push
        run: |
          git config --global user.email "action@github.com"
          git config --global user.name "GitHub Action"
          git add releases/
          git commit -m "Update Comet: ${{ env.DOWNLOAD_DATE }}" || echo "No changes"
          git push
